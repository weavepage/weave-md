{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://weave-md.org/schema/weave-format.schema.json",
  "title": "Weave Format Schema",
  "description": "Schema definition for Weave format elements. Block schemas (ImageBlock, etc.) define the structure of YAML content in fenced code blocks. Inline schemas (InlineMath, Sub) define mdast node structures produced by the parser.",
  "definitions": {
    "ImageBlock": {
      "type": "object",
      "description": "YAML content for ```image blocks",
      "properties": {
        "file": {
          "type": "string",
          "minLength": 1
        },
        "alt": {
          "type": "string"
        },
        "caption": {
          "type": "string"
        },
        "width": {
          "type": "string",
          "description": "Display width hint. Common values: normal, wide, full. Implementations MAY accept any string."
        }
      },
      "required": ["file"],
      "additionalProperties": true
    },
    "GalleryBlock": {
      "type": "object",
      "description": "YAML content for ```gallery blocks",
      "properties": {
        "files": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "minItems": 1
        },
        "alt": {
          "type": "string"
        },
        "caption": {
          "type": "string"
        }
      },
      "required": ["files"],
      "additionalProperties": true
    },
    "AudioBlock": {
      "type": "object",
      "description": "YAML content for ```audio blocks",
      "properties": {
        "file": {
          "type": "string",
          "minLength": 1
        },
        "autoplay": {
          "type": "boolean",
          "default": false
        },
        "controls": {
          "type": "boolean",
          "default": true
        },
        "loop": {
          "type": "boolean",
          "default": false
        }
      },
      "required": ["file"],
      "additionalProperties": true
    },
    "VideoBlock": {
      "type": "object",
      "description": "YAML content for ```video blocks",
      "properties": {
        "file": {
          "type": "string",
          "minLength": 1
        },
        "poster": {
          "type": "string",
          "minLength": 1
        },
        "start": {
          "type": "number",
          "minimum": 0,
          "default": 0
        },
        "autoplay": {
          "type": "boolean",
          "default": false
        },
        "controls": {
          "type": "boolean",
          "default": true
        },
        "loop": {
          "type": "boolean",
          "default": false
        }
      },
      "required": ["file"],
      "additionalProperties": true
    },
    "EmbedBlock": {
      "type": "object",
      "description": "YAML content for ```embed blocks",
      "properties": {
        "url": {
          "type": "string",
          "format": "uri"
        }
      },
      "required": ["url"],
      "additionalProperties": true
    },
    "MathBlock": {
      "type": "object",
      "description": "Content for ```math blocks (raw LaTeX, no YAML)",
      "properties": {
        "value": {
          "type": "string",
          "description": "The LaTeX math content"
        }
      },
      "required": ["value"]
    },
    "InlineMath": {
      "type": "object",
      "description": "Inline math using :math[...] syntax",
      "properties": {
        "type": {
          "type": "string",
          "const": "inlineMath"
        },
        "value": {
          "type": "string",
          "description": "The math expression content (uses 'value' per mdast convention)"
        }
      },
      "required": ["type", "value"]
    },
    "Sub": {
      "type": "object",
      "description": "Inline substitution using :sub[INITIAL]{REPLACEMENT} syntax",
      "properties": {
        "type": {
          "type": "string",
          "const": "sub"
        },
        "children": {
          "description": "Initial content as mdast phrasing nodes (empty array from mdast-util-substitute)",
          "type": "array"
        },
        "data": {
          "type": "object",
          "properties": {
            "replacement": {
              "description": "Replacement content as mdast phrasing nodes (empty array from mdast-util-substitute)",
              "type": "array"
            },
            "rawInitial": {
              "description": "Raw initial text",
              "type": "string"
            },
            "rawReplacement": {
              "description": "Raw replacement text",
              "type": "string"
            }
          },
          "required": ["replacement", "rawInitial", "rawReplacement"]
        }
      },
      "required": ["type", "children", "data"]
    },
    "PreBlock": {
      "type": "object",
      "description": "Content for ```pre blocks (raw text, no YAML)",
      "properties": {
        "value": {
          "type": "string",
          "description": "The preformatted text content"
        }
      },
      "required": ["value"]
    },
    "ExtendedBlock": {
      "oneOf": [
        { "$ref": "#/definitions/ImageBlock" },
        { "$ref": "#/definitions/GalleryBlock" },
        { "$ref": "#/definitions/AudioBlock" },
        { "$ref": "#/definitions/VideoBlock" },
        { "$ref": "#/definitions/EmbedBlock" },
        { "$ref": "#/definitions/MathBlock" },
        { "$ref": "#/definitions/PreBlock" }
      ]
    },
    "ExtendedInline": {
      "oneOf": [
        { "$ref": "#/definitions/InlineMath" },
        { "$ref": "#/definitions/Sub" }
      ]
    }
  }
}
